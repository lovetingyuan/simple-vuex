!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueStorePlugin=t()}(this,function(){"use strict";var e;function t(e,t,n){n.name!==t&&Object.defineProperty(n,"name",{value:t}),e[t]=n}function n(e){throw new Error("vue-store error: "+e)}function r(e){console.warn("vue-store warn: "+e)}return{install:function(t){e&&e===t&&r("Do not install the plugin again."),(e=t).mixin({beforeCreate:function(){var e=this.$options;e.store?this.$store=e.store:e.parent&&e.parent.$store&&(this.$store=e.parent.$store)}})},createStore:function(o,a){e||n("Please install VueStorePlugin first.");var i=!1,_=!1,c="",u=new e,s={addModule:function(e,t,n){var o=e.split(".");n=n||{preserveState:!0};var a=o.pop(),i=p;o.forEach(function(e){i=i[e]});var _={};return!i[a]||!n.preserveState&&"preserveState"in n||Object.assign(_,i[a].__state__),i[a]&&i[a].__vue__?(r(e+" has been added, do not repeat to add it."),i[a]):(i[a]=f(t,o.concat(a),_),i.__state__[a]=i[a].__state__,i[a])},removeModule:function(e){var t=e.split("."),r=t.pop(),o=p;t.forEach(function(e){o=o[e]});try{var a=o[r].__vue__;delete o.__state__[r],delete o[r],a.$destroy()}catch(t){n(e+" can not be removed as it is not dynamic module.")}},subscribe:function(e){c=c||"vuestore-mutation-action-subscribe-event";var t=function(t,n){e(t,n)};return u.$on(c,t),function(){u.$off(c,t)}},replaceState:function(e,t){var n=this;t=t||p,Object.keys(e).forEach(function(r){/[A-Z]/.test(r[0])?t[r]?n.replaceState(e[r],t[r]):(t[r]={__state__:e[r]},t.__state__[r]=e[r]):(_=!0,t.__vue__[r]=e[r],_=!1)})},watch:function(e,t,n){return u.$watch(e,t,n)},getState:function(){return JSON.parse(JSON.stringify(p.__state__))},hotUpdate:function(e,t){var n=this,r="string"==typeof e?t:e,o="string"==typeof e?e:"",a=o.split("."),i=p;a.forEach(function(e){i=i[e]}),Object.keys(i.__getters__).forEach(function(e){delete i.__getters__[e]}),Object.keys(i.__methods__).forEach(function(e){delete i.__methods__[e]}),Object.keys(r).forEach(function(e){if(/[A-Z]/.test(e[0]))n.hotUpdate(o+"."+e,r[e]);else{var t=Object.getOwnPropertyDescriptor(r,e).get;"function"==typeof t?i.__getters__[e]=t:"function"==typeof r[e]&&(i.__methods__[e]=r[e])}})}};function f(n,r,o){void 0===r&&(r=[]),"function"==typeof n&&(n=n());var a={},_={},p={},l={},d=r.length?{}:Object.create(s),v={},y=r.join("/");return Object.keys(n).forEach(function(e){if(/[A-Z]/.test(e[0])){if(!n[e])return;var s=f(n[e],r.concat(e));Object.defineProperty(d,e,{value:s,enumerable:!0,configurable:!1}),p[e]=s.__state__,l[e]=s.__stateGetters__}else{var h=Object.getOwnPropertyDescriptor(n,e).get;if("function"==typeof h){_[e]=h,v.computed=v.computed||{},t(v.computed,e,function(){return _[e].call(l)});var b={get:function(){return d.__vue__[e]},enumerable:!0};Object.defineProperty(l,e,b),Object.defineProperty(d,e,b)}else if("function"==typeof n[e])a[e]=n[e],t(d,e,"$"===e[0]?function(t){return c&&u.$emit(c,{actionType:y?y+"/"+e:e,payload:t},p),a[e].call(d,t)}:function(t){c&&u.$emit(c,{type:y?y+"/"+e:e,payload:t},p),i=!0,a[e].call(p,t),i=!1});else{(v.data=v.data||{})[e]=o&&e in o?o[e]:n[e];b={get:function(){return d.__vue__[e]},set:function(t){d.__vue__[e]=t},enumerable:!0};Object.defineProperty(p,e,b),Object.defineProperty(l,e,b),Object.defineProperty(d,e,b)}}}),Object.defineProperties(d,{__vue__:{value:new e(v)},__methods__:{value:a},__getters__:{value:_},__state__:{value:p},__stateGetters__:{value:l}}),d}var p=f(o);return a&&a.strict&&u.$watch(function(){return p.__state__},function(){i||_||u.$nextTick(function(){n("Only mutation could change state.")})},{deep:!0,sync:!0}),a&&Array.isArray(a.plugins)&&a.plugins.forEach(function(e){"function"==typeof e&&e(p)}),p}}});
