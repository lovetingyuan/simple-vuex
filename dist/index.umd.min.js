!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueStorePlugin=t()}(this,function(){"use strict";var e;function t(e,t,n){n.name!==t&&Object.defineProperty(n,"name",{value:t}),e[t]=n}function n(e){throw new Error("vue-store error: "+e)}return{install:function(t){var n;e&&e===t&&(n="Do not install the plugin again.",console.warn("vue-store warn: "+n)),(e=t).mixin({beforeCreate:function(){var e=this.$options;e.store?this.$store=e.store:e.parent&&e.parent.$store&&(this.$store=e.parent.$store)}})},createStore:function(r,o){e||n("Please install VueStorePlugin first.");var a=!1,i=!1,_="",c=new e,u={addModule:function(e,t,r){var o=e.split(".");r=r||{preserveState:!0};var a=o.pop(),i=f;o.forEach(function(e){i=i[e]});var _={};return!i[a]||!r.preserveState&&"preserveState"in r||Object.assign(_,i[a].__state__),i[a]&&i[a].__vue__&&!r.replace&&n(e+"has been added."),i[a]=s(t,o.concat(a),_),i.__state__[a]=i[a].__state__,i[a]},removeModule:function(e){var t=e.split("."),r=t.pop(),o=f;t.forEach(function(e){o=o[e]});try{var a=o[r].__vue__;delete o.__state__[r],delete o[r],a.$destroy()}catch(t){n(e+" can not be removed as it is not dynamic module.")}},subscribe:function(e){_=_||"vuestore-mutation-action-subscribe-event";var t=function(t,n){e(t,n)};return c.$on(_,t),function(){c.$off(_,t)}},replaceState:function(e,t){var n=this;t=t||f,Object.keys(e).forEach(function(r){/[A-Z]/.test(r[0])?t[r]?n.replaceState(e[r],t[r]):(t[r]={__state__:e[r]},t.__state__[r]=e[r]):(i=!0,t.__vue__[r]=e[r],i=!1)})},watch:function(e,t,n){return c.$watch(e,t,n)},getState:function(){return JSON.parse(JSON.stringify(f.__state__))},hotUpdate:function(e,t){var n=this,r="string"==typeof e?t:e,o="string"==typeof e?e:"",a=o.split("."),i=f;a.forEach(function(e){i=i[e]}),Object.keys(i.__getters__).forEach(function(e){delete i.__getters__[e]}),Object.keys(i.__methods__).forEach(function(e){delete i.__methods__[e]}),Object.keys(r).forEach(function(e){if(/[A-Z]/.test(e[0]))n.hotUpdate(o+"."+e,r[e]);else{var t=Object.getOwnPropertyDescriptor(r,e).get;"function"==typeof t?i.__getters__[e]=t:"function"==typeof r[e]&&(i.__methods__[e]=r[e])}})}};function s(n,r,o){void 0===r&&(r=[]),"function"==typeof n&&(n=n());var i={},f={},p={},l={},d=r.length?{}:Object.create(u),v={},y=r.join("/");return Object.keys(n).forEach(function(e){if(/[A-Z]/.test(e[0])){if(!n[e])return;var u=s(n[e],r.concat(e));Object.defineProperty(d,e,{value:u,enumerable:!0,configurable:!1}),p[e]=u.__state__,l[e]=u.__stateGetters__}else{var h=Object.getOwnPropertyDescriptor(n,e).get;if("function"==typeof h){f[e]=h,v.computed=v.computed||{},t(v.computed,e,function(){return f[e].call(l)});var b={get:function(){return d.__vue__[e]},enumerable:!0};Object.defineProperty(l,e,b),Object.defineProperty(d,e,b)}else if("function"==typeof n[e])i[e]=n[e],t(d,e,"$"===e[0]?function(t){return _&&c.$emit(_,{actionType:y?y+"/"+e:e,payload:t},p),i[e].call(d,t)}:function(t){_&&c.$emit(_,{type:y?y+"/"+e:e,payload:t},p),a=!0,i[e].call(p,t),a=!1});else{(v.data=v.data||{})[e]=o&&e in o?o[e]:n[e];b={get:function(){return d.__vue__[e]},set:function(t){d.__vue__[e]=t},enumerable:!0};Object.defineProperty(p,e,b),Object.defineProperty(l,e,b),Object.defineProperty(d,e,b)}}}),Object.defineProperties(d,{__vue__:{value:new e(v)},__methods__:{value:i},__getters__:{value:f},__state__:{value:p},__stateGetters__:{value:l}}),d}var f=s(r);return o&&o.strict&&c.$watch(function(){return f.__state__},function(){a||i||c.$nextTick(function(){n("Only mutation could change state.")})},{deep:!0,sync:!0}),o&&Array.isArray(o.plugins)&&o.plugins.forEach(function(e){"function"==typeof e&&e(f)}),f}}});
